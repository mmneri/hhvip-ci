!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";function t(e,t){this.container=e,this.options=t,this.init()}function n(t,n){this.widget=t,this.options=e.extend({},n),this.detectService(),this.service&&this.init()}function r(e){function t(e,t){return t.toUpper()}var n={},r=e.data();for(var i in r){var s=r[i];"yes"===s?s=!0:"no"===s&&(s=!1),n[i.replace(/-(\w)/g,t)]=s}return n}function i(e,t){return s(e,t,encodeURIComponent)}function s(e,t,n){return e.replace(/\{([^\}]+)\}/g,function(e,r){return r in t?n?n(t[r]):t[r]:e})}function o(e,t){var n=l+e;return n+" "+n+"_"+t}function u(t,n){function r(o){"keydown"===o.type&&27!==o.which||e(o.target).closest(t).length||(t.removeClass(c),i.off(s,r),e.isFunction(n)&&n())}var i=e(document),s="click touchstart keydown";i.on(s,r)}function a(e){var t=10;if(document.documentElement.getBoundingClientRect){var n=parseInt(e.css("left"),10),r=parseInt(e.css("top"),10),i=e[0].getBoundingClientRect();i.left<t?e.css("left",t-i.left+n):i.right>window.innerWidth-t&&e.css("left",window.innerWidth-i.right-t+n),i.top<t?e.css("top",t-i.top+r):i.bottom>window.innerHeight-t&&e.css("top",window.innerHeight-i.bottom-t+r)}e.addClass(c)}var f="social-likes",l=f+"__",c=f+"_opened",h="https:"===location.protocol?"https:":"http:",p={facebook:{counterUrl:"https://graph.facebook.com/fql?q=SELECT+total_count+FROM+link_stat+WHERE+url%3D%22{url}%22&callback=?",convertNumber:function(e){return e.data[0].total_count},popupUrl:"https://www.facebook.com/sharer/sharer.php?u={url}",popupWidth:600,popupHeight:500},twitter:{counterUrl:h+"//urls.api.twitter.com/1/urls/count.json?url={url}&callback=?",convertNumber:function(e){return e.count},popupUrl:h+"//twitter.com/intent/tweet?url={url}&text={title}",popupWidth:600,popupHeight:450,click:function(){return/[\.:\-–—]\s*$/.test(this.options.title)||(this.options.title+=":"),!0}},mailru:{counterUrl:h+"//connect.mail.ru/share_count?url_list={url}&callback=1&func=?",convertNumber:function(e){for(var t in e)if(e.hasOwnProperty(t))return e[t].shares},popupUrl:h+"//connect.mail.ru/share?share_url={url}&title={title}",popupWidth:550,popupHeight:360},vkontakte:{counterUrl:h+"//vk.com/share.php?act=count&url={url}&index={index}",counter:function(t,n){var r=p.vkontakte;r._||(r._=[],window.VK||(window.VK={}),window.VK.Share={count:function(e,t){r._[e].resolve(t)}});var s=r._.length;r._.push(n),e.getScript(i(t,{index:s})).fail(n.reject)},popupUrl:h+"//vk.com/share.php?url={url}&title={title}",popupWidth:550,popupHeight:330},odnoklassniki:{counterUrl:h+"//www.odnoklassniki.ru/dk?st.cmd=shareData&ref={url}&cb=?",convertNumber:function(e){return e.count},popupUrl:h+"//www.odnoklassniki.ru/dk?st.cmd=addShare&st._surl={url}",popupWidth:550,popupHeight:360},plusone:{counterUrl:h+"//share.yandex.ru/gpp.xml?url={url}",counter:function(t,n){var r=p.plusone;return r._?(n.reject(),void 0):(window.services||(window.services={}),window.services.gplus={cb:function(e){r._.resolve(e)}},r._=n,e.getScript(i(t)).fail(n.reject),void 0)},popupUrl:"https://plus.google.com/share?url={url}",popupWidth:700,popupHeight:500},pinterest:{counterUrl:h+"//api.pinterest.com/v1/urls/count.json?url={url}&callback=?",convertNumber:function(e){return e.count},popupUrl:h+"//pinterest.com/pin/create/button/?url={url}&description={title}",popupWidth:630,popupHeight:270}},d={promises:{},fetch:function(t,n,r){d.promises[t]||(d.promises[t]={});var s=d.promises[t];if(!r.forceUpdate&&s[n])return s[n];var o=e.extend({},p[t],r),u=e.Deferred(),a=o.counterUrl&&i(o.counterUrl,{url:n});return e.isFunction(o.counter)?o.counter(a,u):o.counterUrl?e.getJSON(a).done(function(t){try{var n=t;e.isFunction(o.convertNumber)&&(n=o.convertNumber(t)),u.resolve(n)}catch(r){u.reject()}}).fail(u.reject):u.reject(),s[n]=u.promise(),s[n]}};e.fn.socialLikes=function(n){return this.each(function(){var i=e(this),s=i.data(f);s?e.isPlainObject(n)&&s.update(n):(s=new t(i,e.extend({},e.fn.socialLikes.defaults,n,r(i))),i.data(f,s))})},e.fn.socialLikes.defaults={url:window.location.href.replace(window.location.hash,""),title:document.title,counters:!0,zeroes:!1,wait:500,popupCheckInterval:500,singleTitle:"Share"},t.prototype={init:function(){this.container.addClass(f),this.single=this.container.hasClass(f+"_single"),this.initUserButtons(),this.number=0,this.container.on("counter."+f,e.proxy(this.updateCounter,this));var t=this.container.children();this.countersLeft=t.length,this.makeSingleButton(),this.buttons=[],t.each(e.proxy(function(t,r){this.buttons.push(new n(e(r),this.options))},this)),this.options.counters?this.timer=setTimeout(e.proxy(this.appear,this),this.options.wait):this.appear()},initUserButtons:function(){!this.userButtonInited&&window.socialLikesButtons&&e.extend(!0,p,socialLikesButtons),this.userButtonInited=!0},makeSingleButton:function(){if(this.single){var t=this.container;t.addClass(f+"_vertical"),t.wrap(e("<div>",{"class":f+"_single-w"}));var n=t.parent(),r=e("<div>",{"class":o("widget","single")}),i=e(s('<div><span class="{iconCls}"></span> THIS IS A BUTTON {title}</div>',{buttonCls:o("button","single"),iconCls:o("icon","single"),title:this.options.singleTitle}));r.append(i),n.append(r),r.click(function(){var e=f+"__widget_active";return r.addClass(e),t.css({left:-(t.width()-r.width())/2,top:-t.height()}),a(t),u(t,function(){r.removeClass(e)}),!1}),this.widget=r}},update:function(t){if(t.forceUpdate||t.url!==this.options.url){this.number=0,this.countersLeft=this.buttons.length,this.widget&&this.widget.find("."+f+"__counter").remove(),e.extend(this.options,t);for(var n=0;n<this.buttons.length;n++)this.buttons[n].update(t)}},updateCounter:function(e,t,n){n&&(this.number+=n,this.single&&this.getCounterElem().text(this.number)),this.countersLeft--,0===this.countersLeft&&(this.appear(),this.container.addClass(f+"_ready"),this.container.trigger("ready."+f,this.number))},appear:function(){this.container.addClass(f+"_visible")},getCounterElem:function(){var t=this.widget.find("."+l+"counter_single");return t.length||(t=e("<span>",{"class":o("counter","single")}),this.widget.append(t)),t}},n.prototype={init:function(){this.detectParams(),this.initHtml(),this.initCounter()},update:function(t){e.extend(this.options,{forceUpdate:!1},t),this.widget.find("."+f+"__counter").remove(),this.initCounter()},detectService:function(){for(var t=this.widget[0].classList||this.widget[0].className.split(" "),n=0;n<t.length;n++){var r=t[n];if(p[r])return this.service=r,e.extend(this.options,p[r]),void 0}},detectParams:function(){var e=this.widget.data();if(e.counter){var t=parseInt(e.counter,10);isNaN(t)?this.options.counterUrl=e.counter:this.options.counterNumber=t}e.title&&(this.options.title=e.title),e.url&&(this.options.url=e.url)},initHtml:function(){var t=this.options,n=this.widget,r=n.find("a");r.length&&this.cloneDataAttrs(r,n);var s=e("<span>",{"class":this.getElementClassNames("button"),text:n.text()});if(t.clickUrl){var o=i(t.clickUrl,{url:t.url,title:t.title}),u=e("<a>",{href:o});this.cloneDataAttrs(n,u),n.replaceWith(u),this.widget=n=u}else n.click(e.proxy(this.click,this));n.removeClass(this.service),n.addClass(this.getElementClassNames("widget")),s.prepend(e("<span>",{"class":this.getElementClassNames("icon")})),n.empty().append(s),this.button=s},initCounter:function(){if(this.options.counters)if(this.options.counterNumber)this.updateCounter(this.options.counterNumber);else{var t={counterUrl:this.options.counterUrl,forceUpdate:this.options.forceUpdate};d.fetch(this.service,this.options.url,t).always(e.proxy(this.updateCounter,this))}},cloneDataAttrs:function(e,t){var n=e.data();for(var r in n)n.hasOwnProperty(r)&&t.data(r,n[r])},getElementClassNames:function(e){return o(e,this.service)},updateCounter:function(t){t=parseInt(t,10)||0;var n={"class":this.getElementClassNames("counter"),text:t};t||this.options.zeroes||(n["class"]+=" "+f+"__counter_empty",n.text="");var r=e("<span>",n);this.widget.append(r),this.widget.trigger("counter."+f,[this.service,t])},click:function(t){var n=this.options,r=!0;if(e.isFunction(n.click)&&(r=n.click.call(this,t)),r){var s=i(n.popupUrl,{url:n.url,title:n.title});s=this.addAdditionalParamsToUrl(s),this.openPopup(s,{width:n.popupWidth,height:n.popupHeight})}return!1},addAdditionalParamsToUrl:function(t){var n=e.param(e.extend(this.widget.data(),this.options.data));if(e.isEmptyObject(n))return t;var r=-1===t.indexOf("?")?"?":"&";return t+r+n},openPopup:function(t,n){var r=Math.round(screen.width/2-n.width/2),i=0;screen.height>n.height&&(i=Math.round(screen.height/3-n.height/2));var s=window.open(t,"sl_"+this.service,"left="+r+",top="+i+",width="+n.width+",height="+n.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");if(s){s.focus(),this.widget.trigger("popup_opened."+f,[this.service,s]);var o=setInterval(e.proxy(function(){s.closed&&(clearInterval(o),this.widget.trigger("popup_closed."+f,this.service))},this),this.options.popupCheckInterval)}else location.href=t}},e(function(){e("."+f).socialLikes()})})